---
title: "AI ë˜ì „ ê²Œì„"
description: "@aws/nx-pluginì„ ì‚¬ìš©í•˜ì—¬ AI ê¸°ë°˜ ë˜ì „ ëª¨í—˜ ê²Œì„ì„ êµ¬ì¶•í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ì—°ìŠµ"
---



import { Aside, Code, FileTree, Steps, Tabs, TabItem } from '@astrojs/starlight/components';
import { Image } from 'astro:assets';
import Drawer from '@components/drawer.astro';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import InstallCommand from '@components/install-command.astro';
import dungeonAdventureArchitecturePng from '@assets/dungeon-game-architecture.png'
import dungeonAdventureErPng from '@assets/dungeon-adventure-er.png'
import baselineWebsitePng from '@assets/baseline-website.png'
import baselineGamePng from '@assets/baseline-game.png'
import nxGraphPng from '@assets/nx-graph.png'
import gameSelectPng from '@assets/game-select.png'
import gameConversationPng from '@assets/game-conversation.png'

## ëª¨ë“ˆ 4: UI êµ¬í˜„

UI êµ¬ì¶•ì„ ì‹œì‘í•˜ë ¤ë©´ ë¡œì»¬ ê°œë°œ ì„œë²„ë¥¼ ë°°í¬ëœ ìƒŒë“œë°•ìŠ¤ë¡œ ì—°ê²°í•´ì•¼ í•©ë‹ˆë‹¤. ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”:

<NxCommands commands={["run @dungeon-adventure/game-ui:load:runtime-config"]} />

ì´ ëª…ë ¹ì–´ëŠ” ë°°í¬ëœ `runtime-config.json` íŒŒì¼ì„ ê°€ì ¸ì™€ `packages/game-ui/public` í´ë”ì— ì €ì¥í•©ë‹ˆë‹¤.

ì´ì œ ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ ê°œë°œ ì„œë²„ë¥¼ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

<NxCommands commands={["run @dungeon-adventure/game-ui:serve"]} />

ë¸Œë¼ìš°ì €ì—ì„œ ë¡œì»¬ ì›¹ì‚¬ì´íŠ¸(http://localhost:4200/)ë¥¼ ì—´ë©´ ë¡œê·¸ì¸ í”„ë¡¬í”„íŠ¸ê°€ í‘œì‹œë˜ê³  ìƒˆ ì‚¬ìš©ì ìƒì„± ê³¼ì •ì„ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì™„ë£Œ í›„ ë² ì´ìŠ¤ë¼ì¸ ì›¹ì‚¬ì´íŠ¸ê°€ í‘œì‹œë©ë‹ˆë‹¤:

<Image src={baselineWebsitePng} alt="ë² ì´ìŠ¤ë¼ì¸ ì›¹ì‚¬ì´íŠ¸" width="800" height="600" />

<Aside type="caution">
_ì´ ëª¨ë“ˆì˜ ë‚˜ë¨¸ì§€ ë¶€ë¶„ì—ì„œ ê°œë°œ ì„œë²„ë¥¼ ê³„ì† ì‹¤í–‰ ìƒíƒœë¡œ ìœ ì§€í•  ê²ƒì´ë¯€ë¡œ, ë³€ê²½ ì‚¬í•­ì´ ë°œìƒí•˜ë©´ ìë™ìœ¼ë¡œ í•« ë¦¬ë¡œë“œë©ë‹ˆë‹¤._
</Aside>

### ìƒˆë¡œìš´ '/game' ê²½ë¡œ ìƒì„±

`@tanstack/react-router`ì˜ ê¸°ëŠ¥ì„ í™œìš©í•´ íƒ€ì… ì•ˆì „í•œ ìƒˆ ê²½ë¡œë¥¼ ìƒì„±í•´ ë³´ê² ìŠµë‹ˆë‹¤. ë‹¤ìŒ ìœ„ì¹˜ì— ë¹ˆ íŒŒì¼ì„ ìƒì„±í•˜ì„¸ìš”: `packages/game-ui/src/routes/game/index.tsx`. ê°œë°œ ì„œë²„ ë¡œê·¸ë¥¼ ì£¼ì‹œí•˜ì„¸ìš”:

```bash
â™»ï¸  ê²½ë¡œ ì¬ìƒì„± ì¤‘...
ğŸŸ¡ /Users/dimecha/dungeon-adventure/packages/game-ui/src/routes/game/index.tsx ì—…ë°ì´íŠ¸
ğŸŸ¡ /Users/dimecha/dungeon-adventure/packages/game-ui/src/routeTree.gen.ts ì—…ë°ì´íŠ¸
âœ… 27ms ë‚´ì— ê²½ë¡œ ì²˜ë¦¬ ì™„ë£Œ
```

`@tanstack/react-router`ê°€ ìë™ìœ¼ë¡œ ìƒˆ ê²½ë¡œë¥¼ êµ¬ì„±í•˜ë©°, ìƒì„±í•œ íŒŒì¼ì— ì´ë¯¸ ê²½ë¡œ ê²½ë¡œê°€ ì±„ì›Œì ¸ ìˆìŠµë‹ˆë‹¤:

```tsx
import { createFileRoute } from '@tanstack/react-router'

export const Route = createFileRoute('/game/')({
  component: RouteComponent,
})

function RouteComponent() {
  return <div>Hello "/game/"!</div>
}
```

ì´ì œ `http://localhost:4200/game`ìœ¼ë¡œ ì´ë™í•˜ë©´ ìƒˆ í˜ì´ì§€ê°€ ë Œë”ë§ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!

<Image src={baselineGamePng} alt="ë² ì´ìŠ¤ë¼ì¸ ê²Œì„" width="800" height="600" />

ê¸°ë³¸ì ìœ¼ë¡œ ìƒˆ `/game` ê²½ë¡œë¥¼ ë¡œë“œí•˜ë„ë¡ `index.tsx` íŒŒì¼ì„ ì—…ë°ì´íŠ¸í•˜ì„¸ìš”. `to` í•„ë“œë¥¼ ì—…ë°ì´íŠ¸í•  ë•Œ íƒ€ì… ì•ˆì „í•œ ê²½ë¡œ ëª©ë¡ì—ì„œ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```diff lang="tsx"
// packages/game-ui/src/routes/index.tsx
import { createFileRoute, Navigate } from '@tanstack/react-router';

export const Route = createFileRoute('/')({
+  component: () => <Navigate to="/game" />,
});

```

ì´ì œ ë” ì´ìƒ í•„ìš”í•˜ì§€ ì•Šì€ `packages/game-ui/src/routes/welcome/` í´ë”ë¥¼ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ë ˆì´ì•„ì›ƒ ì—…ë°ì´íŠ¸

ê¸°ë³¸ êµ¬ì„±ëœ ë ˆì´ì•„ì›ƒì€ SaaS ìŠ¤íƒ€ì¼ ë¹„ì¦ˆë‹ˆìŠ¤ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ë” ê°€ê¹ìŠµë‹ˆë‹¤. ë˜ì „ ìŠ¤íƒ€ì¼ ê²Œì„ì— ì–´ìš¸ë¦¬ë„ë¡ ë ˆì´ì•„ì›ƒì„ ì¬êµ¬ì„±í•˜ê³  í…Œë§ˆë¥¼ ë³€ê²½í•˜ê² ìŠµë‹ˆë‹¤.

`packages/game-ui/src`ì—ì„œ ë‹¤ìŒ ë³€ê²½ ì‚¬í•­ì„ ì ìš©í•˜ì„¸ìš”:

<Tabs>
<TabItem label="config.ts">
```diff lang="typescript"
// packages/game-ui/src/config.ts
export default {
+  applicationName: 'Dungeon Adventure',
};
```
</TabItem>
<TabItem label="components/AppLayout/index.tsx">
```tsx
// packages/game-ui/src/components/AppLayout/index.tsx
import { useAuth } from 'react-oidc-context';
import * as React from 'react';
import Config from '../../config';
import { TopNavigation } from '@cloudscape-design/components';
import { Outlet } from '@tanstack/react-router';

/**
 * ì•± ë ˆì´ì•„ì›ƒ ì •ì˜ ë° ë¼ìš°íŒ… ë¡œì§ í¬í•¨
 */
const AppLayout: React.FC = () => {
  const { user, removeUser, signoutRedirect, clearStaleState } = useAuth();

  return (
    <>
      <TopNavigation
        identity={{
          href: '/',
          title: Config.applicationName,
        }}
        utilities={[
          {
            type: 'menu-dropdown',
            text: `${user?.profile?.['cognito:username']}`,
            iconName: 'user-profile-active',
            onItemClick: (e) => {
              if (e.detail.id === 'signout') {
                removeUser();
                signoutRedirect({
                  post_logout_redirect_uri: window.location.origin,
                  extraQueryParams: {
                    redirect_uri: window.location.origin,
                    response_type: 'code',
                  },
                });
                clearStaleState();
              }
            },
            items: [{ id: 'signout', text: 'Sign out' }],
          },
        ]}
      />
      <Outlet />
    </>
  );
};
export default AppLayout;
```
</TabItem>
<TabItem label="styles.css">
```css
// packages/game-ui/src/styles.css

/* ê²Œì„ ìŠ¤íƒ€ì¼ */
:root {
  --primary-color: rgba(252, 214, 112, 1);
  --secondary-color: rgba(252, 214, 112, 0.8);
  --background-dark: #161d26;
  --background-light: #2a2c3c;
  --text-light: #e1e1e6;
  --text-dark: #1f2937;
}

div#root {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

html,
body {
  margin: 0;
  padding: 0;
  min-height: 100vh;
  width: 100%;
  font-family:
    -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue',
    Arial, sans-serif;
  background: var(--background-dark);
  color: var(--text-dark);
}

/* ê²Œì„ ì¸í„°í˜ì´ìŠ¤ ì»¨í…Œì´ë„ˆ */
.game-interface {
  margin: 2rem;
  min-height: 100%;
  flex-grow: 1;
  display: flex;
  flex-direction: column;
}

/* í—¤ë” ìŠ¤íƒ€ì¼ */
.game-header {
  text-align: center;
  margin-bottom: 2rem;
  padding: 1rem;
}

.game-header h1 {
  font-size: 2.5rem;
  font-weight: bold;
  background: linear-gradient(45deg, #ffd700, #ff6b6b);
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
  margin: 0;
}

/* ì €ì¥ëœ ê²Œì„ ì„¹ì…˜ */
.saved-games {
  margin-bottom: 2rem;
}

.saved-games h2,
.new-game h2 {
  font-size: 1.5rem;
  margin-bottom: 1rem;
  color: var(--text-light);
}

.game-list {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.game-session {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 8px;
  padding: 1rem;
  cursor: pointer;
  transition: all 0.3s ease;
  width: 100%;
  text-align: left;
}

.game-session:hover {
  transform: translateY(-2px);
  background: rgba(255, 255, 255, 0.15);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.player-name {
  font-weight: 600;
  margin-bottom: 0.25rem;
  color: var(--text-light);
}

.genre-name {
  font-size: 0.875rem;
  color: rgba(255, 255, 255, 0.7);
}

/* ìƒˆ ê²Œì„ ì„¹ì…˜ */
.new-game {
  margin-top: 2rem;
}

.game-setup {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

span[data-style='generating'] {
  color: rgba(252, 214, 112, 1) !important;
}

.name-input,
.action-input {
  width: 100%;
  padding: 0.75rem;
  border: 2px solid rgba(255, 255, 255, 0.2);
  border-radius: 8px;
  font-size: 1rem;
}

.name-input:focus,
.action-input:focus {
  outline: none;
  border-color: var(--primary-color);
}

.genre-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1rem;
}

.genre-button {
  background: rgba(255, 255, 255, 0.1);
  border: 2px solid rgba(255, 255, 255, 0.2);
  border-radius: 8px;
  padding: 1rem;
  color: var(--text-light);
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.genre-button:hover {
  background: rgba(252, 214, 112, 1);
  color: var(--text-dark);
  border-color: var(--primary-color);
  transform: translateY(-2px);
}

/* ë©”ì‹œì§€ ì˜ì—­ */
.messages-area {
  flex: 1;
  overflow-y: auto;
  margin-bottom: 1rem;
  align-content: flex-end;
}

.messages-container {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  padding: 1rem;
}

.message {
  padding: 1rem;
  border-radius: 8px;
  max-width: 80%;
  line-height: 1.5;
}

.message.assistant {
  background: var(--secondary-color);
  border-left: 4px solid var(--primary-color);
  margin-right: auto;
  word-wrap: break-word;
  white-space: pre-wrap;
  margin: 0 !important;
}

.message.user {
  background: rgba(220, 220, 220, 0.7);
  border-right: 4px solid rgba(220, 220, 220, 0.7);
  margin-left: auto;
}

/* ì…ë ¥ ì˜ì—­ */
.input-area {
  padding: 1rem;
  position: sticky;
  bottom: 0;
}

/* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ */
.messages-area::-webkit-scrollbar {
  width: 6px;
}

.messages-area::-webkit-scrollbar-track {
  background: transparent;
}

.messages-area::-webkit-scrollbar-thumb {
  background-color: rgba(255, 255, 255, 0.3);
  border-radius: 3px;
}

/* Firefoxìš© */
.messages-area {
  scrollbar-width: thin;
  scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
}
```
</TabItem>
</Tabs>

ì´ì œ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” `packages/game-ui/src/components/AppLayout/navitems.ts`ì™€ `packages/game-ui/src/hooks/useAppLayout.tsx` íŒŒì¼ì„ ì‚­ì œí•˜ì„¸ìš”.

### ê²Œì„ í˜ì´ì§€

APIë¥¼ í˜¸ì¶œí•  ê²Œì„ í˜ì´ì§€ë¥¼ ìƒì„±í•˜ê³  ê²Œì„ êµ¬í˜„ì„ ì™„ì„±í•˜ì„¸ìš”:

<Tabs>
<TabItem label="index.tsx">
```tsx
// packages/game-ui/src/routes/game/index.tsx
import { FormField, Spinner } from '@cloudscape-design/components';
import { useInfiniteQuery, useMutation } from '@tanstack/react-query';
import { createFileRoute, useNavigate } from '@tanstack/react-router';
import {
  createRef,
  LegacyRef,
  MutableRefObject,
  useEffect,
  useMemo,
  useState,
} from 'react';
import { useGameApi } from '../../hooks/useGameApi';
import { IAction, IGame } from ':dungeon-adventure/game-api-schema';

type IGameState = Omit<IGame, 'lastUpdated'> & { actions: IAction[] };

export const Route = createFileRoute('/game/')({
  component: RouteComponent,
});

// í™”ë©´ ë‚´ ê°€ì‹œì„± í™•ì¸ í›…
export function useIsVisible(ref: MutableRefObject<any>) {
  const [isIntersecting, setIntersecting] = useState(false);

  useEffect(() => {
    const observer = new IntersectionObserver(([entry]) =>
      setIntersecting(entry.isIntersecting),
    );

    ref.current && observer.observe(ref.current);
    return () => {
      observer.disconnect();
    };
  }, [ref]);

  return isIntersecting;
}

function RouteComponent() {
  const [playerName, setPlayerName] = useState('');
  const navigate = useNavigate();
  const ref = createRef();
  const isLastGameVisible = useIsVisible(ref);

  const gameApi = useGameApi();
  const saveGameMutation = useMutation(gameApi.games.save.mutationOptions());

  const {
    data: gamesPages,
    fetchNextPage,
    hasNextPage,
    isFetchingNextPage,
  } = useInfiniteQuery(
    gameApi.games.query.infiniteQueryOptions(
      { limit: 10 },
      { getNextPageParam: ({ cursor }) => cursor },
    ),
  );
  const games = useMemo(() => {
    return gamesPages?.pages.flatMap((page) => page.items) || [];
  }, [gamesPages]);

  // ë§ˆì§€ë§‰ ê²Œì„ì´ ë³´ì´ë©´ ì¶”ê°€ ê²Œì„ ë¡œë“œ
  useEffect(() => {
    if (isLastGameVisible && hasNextPage && !isFetchingNextPage) {
      fetchNextPage();
    }
  }, [isFetchingNextPage, hasNextPage, fetchNextPage, isLastGameVisible]);

  const playerAlreadyExists = (playerName?: string) => {
    return !!games?.find((s) => s.playerName === playerName);
  };

  // ìƒˆ ê²Œì„ ìƒì„±
  const handleStartGame = async (
    playerName: string,
    genre: IGameState['genre'],
  ) => {
    if (playerAlreadyExists(playerName)) {
      return;
    }
    try {
      await saveGameMutation.mutateAsync({
        playerName,
        genre,
      });

      await handleLoadGame(playerName, genre);
    } catch (error) {
      console.error('ê²Œì„ ì‹œì‘ ì‹¤íŒ¨:', error);
    }
  };

  // ê¸°ì¡´ ê²Œì„ ë¡œë“œ
  const handleLoadGame = async (
    playerName: string,
    genre: IGameState['genre'],
  ) => {
    await navigate({
      to: '/game/$playerName',
      params: { playerName },
      search: { genre },
    });
  };

  return (
    <div className="game-interface">
      <header className="game-header">
        <h1>AI ë˜ì „ ì–´ë“œë²¤ì²˜</h1>
      </header>

      {/* ìƒˆ ê²Œì„ ì„¹ì…˜ */}
      <div className="new-game">
        <h2>ìƒˆ ê²Œì„ ì‹œì‘</h2>
        <div className="game-setup">
          <FormField
            errorText={
              playerAlreadyExists(playerName)
                ? `${playerName} ì´ë¯¸ ì¡´ì¬í•¨`
                : undefined
            }
          >
            <input
              type="text"
              placeholder="ì´ë¦„ ì…ë ¥"
              className="name-input"
              onChange={(e) => setPlayerName(e.target.value)}
              onKeyDown={(e) => {
                if (e.key === 'Enter') {
                  const input = e.currentTarget;
                  handleStartGame(input.value, 'medieval');
                }
              }}
            />
          </FormField>
          <div className="genre-grid">
            {(['zombie', 'superhero', 'medieval'] as const).map((genre) => (
              <button
                key={genre}
                className="genre-button"
                onClick={() => {
                  const playerName = document.querySelector('input')?.value;
                  if (playerName) {
                    handleStartGame(playerName, genre);
                  }
                }}
              >
                {genre.charAt(0).toUpperCase() + genre.slice(1)}
              </button>
            ))}
          </div>
        </div>
      </div>

      {/* ì €ì¥ëœ ê²Œì„ ì„¹ì…˜ */}
      {games && games.length > 0 && (
        <div className="saved-games">
          <h2>ê²Œì„ ê³„ì†í•˜ê¸°</h2>
          <div className="game-list">
            {games.map((game, idx) => (
              <button
                key={game.playerName}
                ref={
                  idx === games.length - 1
                    ? (ref as LegacyRef<HTMLButtonElement>)
                    : undefined
                }
                onClick={() => handleLoadGame(game.playerName, game.genre)}
                className="game-session"
              >
                <div className="player-name">{game.playerName}</div>
                <div className="genre-name">
                  {game.genre.charAt(0).toUpperCase() + game.genre.slice(1)}
                </div>
              </button>
            ))}
            {isFetchingNextPage && <Spinner data-style="generating" size="big" />}
          </div>
        </div>
      )}
    </div>
  );
}
```
</TabItem>
<TabItem label="$playerName.tsx">

```tsx title="packages/game-ui/src/routes/game/$playerName.tsx"
import { PromptInput, Spinner } from '@cloudscape-design/components';
import { useMutation, useQuery } from '@tanstack/react-query';
import { createFileRoute } from '@tanstack/react-router';
import { useEffect, useRef, useState } from 'react';
import { useGameApi } from '../../hooks/useGameApi';
import { useStoryApiClient } from '../../hooks/useStoryApiClient';
import type { IAction, IGame } from ':dungeon-adventure/game-api-schema';

type IGameState = Omit<IGame, 'lastUpdated'> & { actions: IAction[] };

export const Route = createFileRoute('/game/$playerName')({
  component: RouteComponent,
  validateSearch: (search: Record<string, unknown>) => {
    return {
      genre: search.genre as IGameState['genre'],
    };
  },
});

function RouteComponent() {
  const { playerName } = Route.useParams();
  const { genre } = Route.useSearch();

  const [currentInput, setCurrentInput] = useState('');
  const [streamingContent, setStreamingContent] = useState('');

  const messagesEndRef = useRef<HTMLDivElement>(null);

  const gameApi = useGameApi();
  const storyApi = useStoryApiClient();
  const saveActionMutation = useMutation(
    gameApi.actions.save.mutationOptions(),
  );
  const gameActionsQuery = useQuery(
    gameApi.actions.query.queryOptions({ playerName, limit: 100 }),
  );

  // ì•¡ì…˜ì´ ì—†ìœ¼ë©´ ìƒˆ ê²Œì„ - ì´ˆê¸° ìŠ¤í† ë¦¬ ìƒì„±
  useEffect(() => {
    if (
      !gameActionsQuery.isLoading &&
      gameActionsQuery.data?.items &&
      gameActionsQuery.data?.items.length === 0
    ) {
      generateStory({
        playerName,
        genre,
        actions: [],
      });
    }
  }, [gameActionsQuery.data?.items, gameActionsQuery.isLoading]);

  const generateStoryMutation = useMutation({
    mutationFn: async ({ playerName, genre, actions }: IGameState) => {
      let content = '';
      for await (const chunk of storyApi.generateStory({
        playerName,
        genre,
        actions,
      })) {
        content += chunk;
        // ìŠ¤íŠ¸ë¦¬ë° ë°©ì‹ìœ¼ë¡œ ë‚´ìš© ë Œë”ë§
        setStreamingContent(content);
      }

      return content;
    },
  });

  // ë§ˆì§€ë§‰ ë©”ì‹œì§€ë¡œ ìŠ¤í¬ë¡¤
  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  };

  // ë°ì´í„° ë³€ê²½ ì‹œ ìŠ¤í¬ë¡¤ ì—…ë°ì´íŠ¸
  useEffect(() => {
    scrollToBottom();
  }, [streamingContent, gameActionsQuery]);

  // ìŠ¤í† ë¦¬ ì§„í–‰
  const generateStory = async ({ playerName, genre, actions }: IGameState) => {
    try {
      const content = await generateStoryMutation.mutateAsync({
        playerName,
        genre,
        actions,
      });

      // ì–´ì‹œìŠ¤í„´íŠ¸ ì‘ë‹µ ì €ì¥
      await saveActionMutation.mutateAsync({
        playerName,
        role: 'assistant',
        content,
      });

      await gameActionsQuery.refetch();

      setStreamingContent('');
    } catch (error) {
      console.error('ìŠ¤í† ë¦¬ ìƒì„± ì‹¤íŒ¨:', error);
    }
  };

  // ì‚¬ìš©ì ì…ë ¥ ì²˜ë¦¬
  const handleSubmitAction = async () => {
    if (!currentInput.trim()) return;

    const userAction: IAction = {
      playerName,
      role: 'user' as const,
      content: currentInput,
      timestamp: new Date().toISOString(),
    };

    // ì‚¬ìš©ì ì•¡ì…˜ ì €ì¥
    await saveActionMutation.mutateAsync(userAction);
    await gameActionsQuery.refetch();

    setCurrentInput('');

    // ì‘ë‹µ ìƒì„±
    await generateStory({
      genre,
      playerName,
      actions: [...(gameActionsQuery.data?.items ?? []), userAction],
    });
  };

  return (
    <div className="game-interface">
      <div className="messages-area">
        <div className="messages-container">
          {gameActionsQuery.data?.items
            .concat(
              streamingContent.length > 0
                ? [
                    {
                      playerName,
                      role: 'assistant',
                      content: streamingContent,
                      timestamp: new Date().toISOString(),
                    },
                  ]
                : [],
            )
            .map((action, i) => (
              <div
                key={i}
                className={`message ${
                  action.role === 'assistant' ? 'assistant' : 'user'
                }`}
              >
                {action.content}
              </div>
            ))}
          {generateStoryMutation.isPending && streamingContent.length === 0 && (
            <Spinner data-style="generating" size="big" />
          )}
          <div ref={messagesEndRef} />
        </div>
      </div>
      <div className="input-area">
        <PromptInput
          onChange={({ detail }) => setCurrentInput(detail.value)}
          value={currentInput}
          actionButtonAriaLabel="ë©”ì‹œì§€ ë³´ë‚´ê¸°"
          actionButtonIconName="send"
          ariaLabel="ê¸°ë³¸ ì…ë ¥ í”„ë¡¬í”„íŠ¸"
          placeholder="í–‰ë™ì„ ì…ë ¥í•˜ì„¸ìš”"
          onAction={handleSubmitAction}
        />
      </div>
    </div>
  );
}
```

<Aside type="tip">
`$playerName` êµ¬ë¬¸ì€ `@tanstack/react-router`ì—ê²Œ [ê²½ë¡œ íŒŒë¼ë¯¸í„°](https://tanstack.com/router/v1/docs/framework/react/guide/path-params)ë¡œ ì²˜ë¦¬í•˜ë„ë¡ ì§€ì‹œí•©ë‹ˆë‹¤. ì¶”ê°€ë¡œ `validateSearch` ë©”ì„œë“œë¥¼ êµ¬í˜„í•´ `genre` ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ê°€ ê°•ë ¥í•œ íƒ€ì… ì²´í¬ë¥¼ ë°›ë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤.
</Aside>
</TabItem>
</Tabs>

ì´ì œ ë³€ê²½ ì‚¬í•­ì„ ì ìš©í•˜ë©´ ë¡œì»¬ ê°œë°œ ì„œë²„(http://localhost:4200/)ì—ì„œ ê²Œì„ì„ í”Œë ˆì´í•  ì¤€ë¹„ê°€ ì™„ë£Œë©ë‹ˆë‹¤!

<Drawer title="ë¹Œë“œ ë° ë°°í¬" trigger="ì›í•  ê²½ìš° Cloudfrontì— ì½”ë“œ ë¹Œë“œ ë° ë°°í¬ ê°€ëŠ¥">

ë¹Œë“œ ëª…ë ¹ì–´:

<NxCommands commands={['run-many --target build --all']} />

ë°°í¬ ëª…ë ¹ì–´:

<NxCommands commands={['run @dungeon-adventure/infra:deploy dungeon-adventure-infra-sandbox']} />

ë°°í¬ ì™„ë£Œ í›„ CDK ë°°í¬ ì¶œë ¥ì—ì„œ Cloudfront URLì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

</Drawer>

<Image src={gameSelectPng} alt="ê²Œì„ ì„ íƒ í™”ë©´" width="500" height="400" />
<div style="margin-top: -100px; margin-left: 100px;">
<Image src={gameConversationPng} alt="ê²Œì„ ëŒ€í™” í™”ë©´" width="500" height="400" />
</div>

ì¶•í•˜í•©ë‹ˆë‹¤. ë˜ì „ ì–´ë“œë²¤ì²˜ ê²Œì„ì„ ì„±ê³µì ìœ¼ë¡œ êµ¬ì¶•í•˜ê³  ë°°í¬í–ˆìŠµë‹ˆë‹¤! ğŸ‰ğŸ‰ğŸ‰